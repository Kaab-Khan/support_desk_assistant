╔══════════════════════════════════════════════════════════════════════════════════════════╗
║                AI SUPPORT DESK ASSISTANT - END-TO-END WORKFLOW GUIDE                      ║
╚══════════════════════════════════════════════════════════════════════════════════════════╝

This document explains the complete workflow of the AI Support Desk Assistant system,
from startup to ticket processing, including all major features and data flows.

═══════════════════════════════════════════════════════════════════════════════════════════
                                 SYSTEM INITIALIZATION
═══════════════════════════════════════════════════════════════════════════════════════════

1. APPLICATION STARTUP
   ────────────────────
   When the system starts (e.g., `uvicorn app.main:app`):

   a) Configuration Loading (config.py)
      • Loads environment variables from .env file
      • Validates required API keys:
        - OPENAI_API_KEY
        - PINECONE_API_KEY
        - PINECONE_INDEX_NAME
      • Sets database path: sqlite:///data/support.db
      • Sets data directories: data/docs, data/vectorstore

   b) Database Initialization (db.py + models.py)
      • Creates SQLAlchemy engine connected to SQLite
      • Creates "tickets" table if it doesn't exist
      • Table columns:
        - id (Primary Key)
        - text (ticket content)
        - action (reply/escalate/close)
        - reply (AI-generated response)
        - tags (comma-separated)
        - reason (decision explanation)
        - created_at (timestamp)
        - human_label (feedback)

   c) Vector Store Connection (vectorstore.py)
      • Initializes Pinecone client
      • Connects to Pinecone index (or creates if missing)
      • Index specs:
        - Dimension: 1536 (OpenAI ada-002 embeddings)
        - Metric: cosine similarity
        - Deployment: Serverless AWS (us-east-1)

   d) Service Initialization (singleton pattern)
      • RagService: Ready for knowledge base queries
      • SummariserService: Ready for text summarization
      • TicketAgentService: Ready for ticket processing

   e) FastAPI Application
      • Registers 5 REST API endpoints
      • Starts HTTP server (default: http://localhost:8000)
      • Auto-generates API docs at /docs


═══════════════════════════════════════════════════════════════════════════════════════════
                            WORKFLOW 1: KNOWLEDGE BASE SETUP
═══════════════════════════════════════════════════════════════════════════════════════════

Before the system can answer questions, you need to populate the vector database with
knowledge base documents. This is typically done via scripts or admin endpoints.

STEP 1: Document Ingestion
───────────────────────────
   • Admin loads support documents (FAQs, manuals, policies)
   • Documents placed in data/docs/ directory

STEP 2: Embedding Generation
─────────────────────────────
   • Script calls VectorStoreClient.upsert_documents()
   • For each document:
     a) Text is sent to OpenAI API (text-embedding-ada-002)
     b) Returns 1536-dimensional vector embedding
     c) Embedding represents semantic meaning of text

STEP 3: Vector Storage
───────────────────────
   • Embeddings uploaded to Pinecone cloud database
   • Each vector stored with metadata:
     - source: document name/filename
     - text: original text snippet
     - category: optional classification
   • Pinecone indexes vectors for fast similarity search

EXAMPLE:
   Document: "To reset your password, click 'Forgot Password' on login page..."
   → OpenAI generates [0.234, -0.567, 0.891, ...] (1536 numbers)
   → Stored in Pinecone with metadata: {"source": "password_reset.pdf", "text": "..."}


═══════════════════════════════════════════════════════════════════════════════════════════
                       WORKFLOW 2: AUTOMATED TICKET PROCESSING
═══════════════════════════════════════════════════════════════════════════════════════════

This is the PRIMARY workflow - automatically triaging and responding to support tickets.

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ USER ACTION: Customer submits a support ticket                                           │
│ Example: "I forgot my password and can't log into my account"                            │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: API REQUEST                                                                      │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ POST /tickets/agent                                                                      │
│ Body: {                                                                                  │
│   "ticket": "I forgot my password and can't log into my account"                        │
│ }                                                                                        │
│                                                                                          │
│ Endpoint: process_ticket() in main.py (line 82-102)                                     │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: TICKET AGENT SERVICE - Orchestration                                            │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ TicketAgentService.process_ticket() in agent_service.py (line 48-110)                   │
│                                                                                          │
│ The agent coordinates multiple AI services to analyze the ticket:                       │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                     │
                     ├──────────────────┐
                     │                  │
                     ▼                  ▼
┌──────────────────────────────────┐  ┌──────────────────────────────────┐
│ STEP 3A: RAG SERVICE             │  │ STEP 3B: SUMMARISER SERVICE      │
│ (Knowledge Base Lookup)          │  │ (Tag Extraction)                 │
│ ───────────────────────────────  │  │ ───────────────────────────────  │
│                                  │  │                                  │
│ RagService.answer()              │  │ SummariserService.summarise()    │
│ (rag_service.py line 49-118)     │  │ (summariser.py line 40-91)       │
└──────────────────────────────────┘  └──────────────────────────────────┘
                     │                                  │
                     ▼                                  ▼

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ SUB-WORKFLOW 3A: RAG (RETRIEVAL-AUGMENTED GENERATION)                                   │
│ ═════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│ 3A.1: Query Embedding                                                                    │
│       • Ticket text sent to OpenAI embeddings API                                       │
│       • Returns query vector: [0.123, -0.456, ...]                                      │
│                                                                                          │
│ 3A.2: Semantic Search (vectorstore.py line 128-175)                                     │
│       • VectorStoreClient.query_similar(query="I forgot my password...", top_k=5)       │
│       • Pinecone searches for 5 most similar document vectors                           │
│       • Uses cosine similarity to find closest matches                                  │
│       • Returns:                                                                         │
│         [                                                                                │
│           {id: "doc-42", score: 0.92, metadata: {text: "To reset password..."}},        │
│           {id: "doc-17", score: 0.87, metadata: {text: "Password recovery..."}},        │
│           ...                                                                            │
│         ]                                                                                │
│                                                                                          │
│ 3A.3: Context Building                                                                   │
│       • Extracts text from top 5 matched documents                                      │
│       • Builds context string:                                                           │
│         "Document 1: To reset password, click Forgot Password...                        │
│          Document 2: Password recovery requires email verification...                   │
│          ..."                                                                            │
│                                                                                          │
│ 3A.4: LLM Answer Generation                                                              │
│       • Calls OpenAI Chat API (gpt-4o-mini)                                             │
│       • System prompt: "Answer using ONLY provided context"                             │
│       • User message:                                                                    │
│         "Context: [5 documents about password reset]                                    │
│          Question: I forgot my password and can't log in                                │
│          Answer:"                                                                        │
│       • LLM generates response:                                                          │
│         "To reset your password, visit the login page and click                         │
│          'Forgot Password'. Enter your email and follow the                             │
│          verification link sent to your inbox."                                         │
│                                                                                          │
│ 3A.5: Return Result                                                                      │
│       Returns: {                                                                         │
│         "answer": "To reset your password...",                                          │
│         "sources": [{doc_name: "password_reset.pdf", ...}, ...]                         │
│       }                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ SUB-WORKFLOW 3B: SUMMARIZATION & TAG EXTRACTION                                         │
│ ═════════════════════════════════════════════════════════════════════════════════════   │
│                                                                                          │
│ 3B.1: LLM Tag Extraction                                                                 │
│       • Calls OpenAI Chat API (gpt-4o-mini)                                             │
│       • System prompt: "Extract tags as JSON"                                           │
│       • User message:                                                                    │
│         "Summarise in 3 sentences and extract 3-7 tags:                                 │
│          Text: I forgot my password and can't log in..."                                │
│                                                                                          │
│ 3B.2: JSON Response Parsing                                                              │
│       • LLM returns:                                                                     │
│         {                                                                                │
│           "summary": "User cannot access account due to forgotten password",            │
│           "tags": ["password", "login", "authentication", "account-access"]             │
│         }                                                                                │
│       • Parsed and validated                                                             │
│                                                                                          │
│ 3B.3: Return Result                                                                      │
│       Returns: {"tags": ["password", "login", "authentication", "account-access"]}      │
└──────────────────────────────────────────────────────────────────────────────────────────┘

                     │                                  │
                     └──────────────┬───────────────────┘
                                    ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 4: DECISION LOGIC (agent_service.py line 84-91)                                    │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                          │
│ The agent examines the RAG answer:                                                       │
│                                                                                          │
│ IF answer exists and is not empty:                                                       │
│    action = "reply"                                                                      │
│    reason = "Generated reply using knowledge base context via RAG."                     │
│    reply = [the answer from RAG]                                                         │
│                                                                                          │
│ ELSE:                                                                                     │
│    action = "escalate"                                                                   │
│    reason = "Could not generate automated reply; escalating to human agent."            │
│    reply = None                                                                          │
│                                                                                          │
│ In our example:                                                                          │
│    action = "reply"                                                                      │
│    reply = "To reset your password, visit the login page..."                            │
│    tags = ["password", "login", "authentication", "account-access"]                     │
│    reason = "Generated reply using knowledge base context via RAG."                     │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                    ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 5: DATABASE PERSISTENCE (crud.py line 15-54)                                       │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                          │
│ crud.create_ticket() saves to SQLite:                                                    │
│                                                                                          │
│ INSERT INTO tickets (                                                                    │
│   text,                                                                                  │
│   action,                                                                                │
│   reply,                                                                                 │
│   tags,                                                                                  │
│   reason,                                                                                │
│   created_at,                                                                            │
│   human_label                                                                            │
│ ) VALUES (                                                                               │
│   "I forgot my password and can't log into my account",                                 │
│   "reply",                                                                               │
│   "To reset your password, visit the login page...",                                    │
│   "password,login,authentication,account-access",                                       │
│   "Generated reply using knowledge base context via RAG.",                              │
│   "2024-11-24 11:38:29",                                                                │
│   NULL                                                                                   │
│ );                                                                                       │
│                                                                                          │
│ Returns: Ticket object with id=1                                                         │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                    ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 6: API RESPONSE                                                                     │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                          │
│ Response to client (200 OK):                                                             │
│ {                                                                                        │
│   "id": 1,                                                                               │
│   "action": "reply",                                                                     │
│   "reply": "To reset your password, visit the login page and click 'Forgot Password'.   │
│             Enter your email and follow the verification link sent to your inbox.",      │
│   "reason": "Generated reply using knowledge base context via RAG.",                    │
│   "tags": ["password", "login", "authentication", "account-access"]                     │
│ }                                                                                        │
│                                                                                          │
│ Total time: ~2-4 seconds (includes 2 OpenAI API calls + Pinecone query)                 │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                    ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 7: BUSINESS LOGIC (External to this system)                                        │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                          │
│ The calling application (e.g., Streamlit UI or ticketing system):                       │
│                                                                                          │
│ IF action == "reply":                                                                    │
│    • Display suggested reply to support agent for review                                │
│    • OR automatically send reply to customer (if confidence high)                       │
│    • Mark ticket as resolved or pending customer response                               │
│                                                                                          │
│ ELSE IF action == "escalate":                                                            │
│    • Route ticket to human support agent queue                                          │
│    • Flag as requiring manual attention                                                 │
│    • Notify senior support staff                                                        │
│                                                                                          │
│ ELSE IF action == "close":                                                               │
│    • Archive ticket as resolved                                                          │
│    • Send closure notification to customer                                              │
└──────────────────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════
                       WORKFLOW 3: HUMAN FEEDBACK LOOP
═══════════════════════════════════════════════════════════════════════════════════════════

After a ticket is processed, human agents can provide feedback to improve the system.

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ SCENARIO: Human agent reviews ticket #1 and provides feedback                            │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: Feedback Submission                                                              │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ POST /tickets/feedback                                                                   │
│ Body: {                                                                                  │
│   "ticket_id": 1,                                                                        │
│   "human_label": "correct - good response"                                              │
│ }                                                                                        │
│                                                                                          │
│ Alternative labels might be:                                                             │
│   • "incorrect - escalate instead"                                                       │
│   • "correct - excellent answer"                                                         │
│   • "partially correct - needs more detail"                                             │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: Database Update (crud.py line 130-156)                                          │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                          │
│ crud.update_ticket_feedback():                                                           │
│                                                                                          │
│ UPDATE tickets                                                                           │
│ SET human_label = "correct - good response"                                             │
│ WHERE id = 1;                                                                            │
│                                                                                          │
│ Returns: Updated Ticket object                                                           │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 3: Feedback Utilization (Future Enhancement)                                       │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│                                                                                          │
│ The stored feedback can be used for:                                                     │
│   • Model fine-tuning (create training dataset from validated tickets)                  │
│   • Quality monitoring (track AI accuracy over time)                                    │
│   • Knowledge base improvements (identify gaps in documentation)                        │
│   • A/B testing (compare different models or prompts)                                   │
│   • Confidence scoring (learn when to auto-reply vs escalate)                           │
└──────────────────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════
                       WORKFLOW 4: STANDALONE RAG QUERY
═══════════════════════════════════════════════════════════════════════════════════════════

Users can query the knowledge base directly without creating a ticket.

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Support agent needs quick answer from knowledge base                           │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: RAG Query Request                                                                │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ POST /rag/query                                                                          │
│ Body: {                                                                                  │
│   "query": "What are the system requirements for version 2.0?"                          │
│ }                                                                                        │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: RAG Processing (Same as Workflow 2, Step 3A)                                    │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│   1. Embed query                                                                         │
│   2. Search Pinecone for similar documents                                              │
│   3. Build context from top 5 matches                                                    │
│   4. Generate answer with OpenAI                                                         │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 3: Response with Sources                                                            │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ Response (200 OK):                                                                       │
│ {                                                                                        │
│   "answer": "Version 2.0 requires Windows 10 or higher, 8GB RAM, and 50GB disk space.", │
│   "sources": [                                                                           │
│     {                                                                                    │
│       "doc_name": "system_requirements_v2.pdf",                                         │
│       "snippet": "System Requirements: Windows 10+, 8GB RAM, 50GB disk..."             │
│     },                                                                                   │
│     {                                                                                    │
│       "doc_name": "installation_guide.pdf",                                             │
│       "snippet": "Before installing, ensure your system meets the requirements..."      │
│     }                                                                                    │
│   ]                                                                                      │
│ }                                                                                        │
│                                                                                          │
│ NOTE: This does NOT create a ticket in the database                                     │
└──────────────────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════
                       WORKFLOW 5: STANDALONE TEXT SUMMARIZATION
═══════════════════════════════════════════════════════════════════════════════════════════

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Summarize long customer emails or chat transcripts                             │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: Summarization Request                                                            │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ POST /summarise                                                                          │
│ Body: {                                                                                  │
│   "text": "Hi, I've been trying to connect to the VPN for 3 days now. It keeps saying   │
│            'authentication failed'. I tried resetting my password twice but still        │
│            can't connect. This is urgent as I need to access client files. My employee   │
│            ID is EMP12345. Can someone help? I also noticed the mobile app crashes       │
│            when I try to view reports..."                                                │
│ }                                                                                        │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: OpenAI Processing                                                                │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ Calls OpenAI (gpt-4o-mini) with instructions to:                                        │
│   • Summarize in ~3 sentences                                                            │
│   • Extract 3-7 relevant tags                                                            │
│   • Return as JSON                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 3: Response                                                                         │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ Response (200 OK):                                                                       │
│ {                                                                                        │
│   "summary": "User unable to connect to VPN due to authentication failures despite      │
│               password resets. Urgently needs access to client files. Also reports       │
│               mobile app crashes when viewing reports.",                                 │
│   "tags": ["vpn", "authentication", "urgent", "mobile-app", "crash", "reports"]         │
│ }                                                                                        │
│                                                                                          │
│ NOTE: This does NOT create a ticket in the database                                     │
└──────────────────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════
                       WORKFLOW 6: TICKET LISTING & MONITORING
═══════════════════════════════════════════════════════════════════════════════════════════

┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Dashboard to view all processed tickets                                        │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: List Request                                                                     │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ GET /tickets?skip=0&limit=50                                                             │
│                                                                                          │
│ Pagination parameters:                                                                   │
│   • skip: Number of records to skip (default: 0)                                        │
│   • limit: Max records to return (default: 50)                                          │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: Database Query                                                                   │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ crud.list_tickets(db, skip=0, limit=50)                                                  │
│                                                                                          │
│ SQL: SELECT * FROM tickets ORDER BY id LIMIT 50 OFFSET 0;                               │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ STEP 3: Response                                                                         │
│ ─────────────────────────────────────────────────────────────────────────────────────   │
│ Response (200 OK):                                                                       │
│ [                                                                                        │
│   {                                                                                      │
│     "id": 1,                                                                             │
│     "text": "I forgot my password and can't log in",                                    │
│     "action": "reply",                                                                   │
│     "reply": "To reset your password...",                                               │
│     "tags": ["password", "login", "authentication", "account-access"],                  │
│     "reason": "Generated reply using knowledge base context via RAG.",                  │
│     "created_at": "2024-11-24T11:38:29",                                                │
│     "human_label": "correct - good response"                                            │
│   },                                                                                     │
│   {                                                                                      │
│     "id": 2,                                                                             │
│     "text": "When will feature X be released?",                                         │
│     "action": "escalate",                                                                │
│     "reply": null,                                                                       │
│     "tags": ["feature-request", "product", "roadmap"],                                  │
│     "reason": "Could not generate automated reply; escalating to human agent.",         │
│     "created_at": "2024-11-24T11:45:12",                                                │
│     "human_label": null                                                                  │
│   }                                                                                      │
│ ]                                                                                        │
└──────────────────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════════════
                              KEY TECHNICAL CONCEPTS
═══════════════════════════════════════════════════════════════════════════════════════════

1. EMBEDDINGS
   ───────────
   • Mathematical representation of text meaning
   • 1536 numbers per text snippet (OpenAI ada-002 model)
   • Similar meanings → similar vectors
   • Example: "reset password" and "password recovery" have close vectors

2. COSINE SIMILARITY
   ──────────────────
   • Measures angle between two vectors
   • Score from -1 to 1 (1 = identical, 0 = unrelated, -1 = opposite)
   • Used by Pinecone to rank document relevance
   • Typical good match: 0.8+ score

3. RETRIEVAL-AUGMENTED GENERATION (RAG)
   ─────────────────────────────────────
   • Hybrid approach: retrieval + generation
   • Step 1: Retrieve relevant documents (retrieval)
   • Step 2: Generate answer using those documents (generation)
   • Benefits:
     - Grounds LLM in factual knowledge base
     - Reduces hallucinations
     - Provides source attribution
     - Works with private/proprietary data

4. VECTOR DATABASE (PINECONE)
   ───────────────────────────
   • Specialized database for storing/searching embeddings
   • Optimized for similarity search (not exact matches)
   • Billions of vectors, millisecond queries
   • Alternative: Weaviate, Qdrant, Chroma, FAISS

5. SINGLETON PATTERN
   ──────────────────
   • Each service initialized once per application lifetime
   • Cached in module-level variable
   • Subsequent calls return same instance
   • Saves resources (API clients, DB connections)
   • Used by: RagService, SummariserService, TicketAgentService, VectorStoreClient

6. DEPENDENCY INJECTION (FASTAPI)
   ────────────────────────────────
   • Depends() function injects dependencies into endpoints
   • get_db() → provides database session
   • get_rag_service() → provides RAG service
   • Automatic lifecycle management (setup/teardown)


═══════════════════════════════════════════════════════════════════════════════════════════
                              PERFORMANCE CONSIDERATIONS
═══════════════════════════════════════════════════════════════════════════════════════════

TYPICAL LATENCIES:
   • OpenAI embeddings (ada-002): 100-300ms
   • Pinecone vector search: 50-150ms
   • OpenAI chat completion (gpt-4o-mini): 1-3 seconds
   • SQLite read/write: <10ms

TOTAL TICKET PROCESSING TIME:
   • Embedding query: ~200ms
   • Pinecone search: ~100ms
   • OpenAI answer generation: ~2s
   • OpenAI tag extraction: ~1.5s (parallel)
   • Database save: ~5ms
   • TOTAL: ~3-4 seconds

BOTTLENECKS:
   • OpenAI API calls (network latency)
   • Token limits (4096 tokens for gpt-4o-mini input)
   • Rate limits (depends on OpenAI tier)

OPTIMIZATION STRATEGIES:
   • Cache frequent queries
   • Batch embedding generation
   • Use streaming for long responses
   • Implement retry logic with exponential backoff
   • Monitor token usage


═══════════════════════════════════════════════════════════════════════════════════════════
                              ERROR HANDLING SCENARIOS
═══════════════════════════════════════════════════════════════════════════════════════════

1. PINECONE CONNECTION FAILURE
   • Symptom: VectorStoreClient.__init__() raises exception
   • Impact: Application fails to start
   • Solution: Verify PINECONE_API_KEY, check network, retry

2. OPENAI API ERROR
   • Symptom: 401 Unauthorized, 429 Rate Limit, 500 Server Error
   • Impact: RAG/Summarizer returns empty/error
   • Solution: Validate API key, implement retry, handle gracefully

3. NO RELEVANT DOCUMENTS FOUND
   • Symptom: Pinecone returns empty matches or low scores
   • Impact: RAG answer is generic or "I don't know"
   • Solution: Agent escalates ticket to human

4. DATABASE LOCK
   • Symptom: SQLite "database is locked" error
   • Impact: Ticket save fails
   • Solution: Retry with exponential backoff, use WAL mode

5. MALFORMED JSON FROM LLM
   • Symptom: json.JSONDecodeError in summariser
   • Impact: Tags extraction fails
   • Solution: Fallback to empty tags list (handled in code)


═══════════════════════════════════════════════════════════════════════════════════════════
                              DEPLOYMENT WORKFLOW
═══════════════════════════════════════════════════════════════════════════════════════════

1. PREREQUISITES
   • Python 3.8+
   • OpenAI API account & key
   • Pinecone account & API key
   • SQLite (included with Python)

2. INSTALLATION
   pip install -r requirements.txt

3. CONFIGURATION
   Create .env file:
   OPENAI_API_KEY=sk-...
   PINECONE_API_KEY=...
   PINECONE_INDEX_NAME=support-kb
   DB_URL=sqlite:///data/support.db

4. DATABASE INITIALIZATION
   python -c "from app.db import engine, Base; from app.models import Ticket; Base.metadata.create_all(engine)"

5. KNOWLEDGE BASE SETUP
   • Run ingestion script to upload documents to Pinecone
   • scripts/ingest_docs.py (if exists)

6. START SERVER
   uvicorn app.main:app --host 0.0.0.0 --port 8000

7. VERIFY
   curl http://localhost:8000/docs
   # Opens interactive API documentation


═══════════════════════════════════════════════════════════════════════════════════════════
                              FUTURE ENHANCEMENTS
═══════════════════════════════════════════════════════════════════════════════════════════

1. CONFIDENCE SCORING
   • Calculate confidence from RAG scores and LLM certainty
   • Auto-reply only when confidence > threshold
   • Escalate uncertain cases

2. FINE-TUNING
   • Use validated tickets (with human_label) as training data
   • Fine-tune classification model
   • Improve action prediction accuracy

3. MULTI-TURN CONVERSATIONS
   • Store conversation history in database
   • Context-aware follow-up responses
   • Session management

4. PRIORITY DETECTION
   • Detect urgent keywords ("critical", "down", "emergency")
   • Assign priority scores
   • Fast-track high-priority tickets

5. SENTIMENT ANALYSIS
   • Detect customer frustration/satisfaction
   • Route angry customers to senior agents
   • Track satisfaction trends

6. ANALYTICS DASHBOARD
   • Ticket volume over time
   • Resolution rate
   • Average response time
   • Tag distribution
   • AI accuracy metrics


═══════════════════════════════════════════════════════════════════════════════════════════
                              CONCLUSION
═══════════════════════════════════════════════════════════════════════════════════════════

This AI Support Desk Assistant combines:
   ✓ Vector search (Pinecone) for semantic knowledge retrieval
   ✓ Large language models (OpenAI) for natural language understanding
   ✓ Automated decision-making for ticket triage
   ✓ Human-in-the-loop feedback for continuous improvement
   ✓ RESTful API for easy integration
   ✓ Persistent storage for audit trails

The system reduces support agent workload by:
   • Automatically answering common questions
   • Drafting response suggestions
   • Categorizing and tagging tickets
   • Intelligently routing complex issues to humans

Key success factors:
   • High-quality knowledge base documents
   • Accurate embeddings and vector search
   • Well-crafted prompts for LLM
   • Continuous feedback loop with human validation

═══════════════════════════════════════════════════════════════════════════════════════════
